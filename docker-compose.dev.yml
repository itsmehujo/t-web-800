version: "3"
name: "tweb800"
services: 
  postgres:
    build: 
      context: ./backend/misc/db
      target: development
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_DB=symfonyweb800
      - POSTGRES_PASSWORD=postgresql__password
    ports:
      - "5432:5432"
    volumes:
      - postgres:/var/lib/postgresql/data
      - ./db:/data
    networks:
      - default
  
  # main symfony app
  main_app:
    build: 
      context: ./backend
      target: development
      args:
        - APP_NAME=main_app
    tty: true
    ports:
      - "${MAIN_BACKEND_PORT}:${MAIN_BACKEND_PORT}" #activities
    links : 
      - postgres
    volumes:
      - ./backend:/code
    working_dir: /code/main_app
    networks:
      - main_app


  # MICROSERVICES
  activities:
    build: 
      context: ./backend
      target: development
      args:
        - APP_NAME=activities
    tty: true
    ports:
      - "${ACTIVITIES_BACKEND_PORT}:${ACTIVITIES_BACKEND_PORT}" #activities
    links : 
      - postgres
    volumes:
      - ./backend:/code
    working_dir: /code/activities
    networks:
      - activities

  hotels:
    build: 
      context: ./backend
      target: development
      args:
        - APP_NAME=hotels
    tty: true
    ports:
      - "${HOTELS_BACKEND_PORT}:${HOTELS_BACKEND_PORT}" #hotels
    links : 
      - postgres
    volumes:
      - ./backend:/code
    working_dir: /code/hotels
    networks:
      - hotels

  maps:
    build: 
      context: ./backend
      target: development
      args:
        - APP_NAME=maps
    tty: true
    ports:
      - "${MAPS_BACKEND_PORT}:${MAPS_BACKEND_PORT}" #maps
    links : 
      - postgres
    volumes:
      - ./backend:/code
    working_dir: /code/maps
    networks:
      - maps

  restaurants:
    build: 
      context: ./backend
      target: development
      args:
        - APP_NAME=restaurants
    tty: true
    ports:
      - "${RESTAURANTS_BACKEND_PORT}:${RESTAURANTS_BACKEND_PORT}" #restaurants
    links : 
      - postgres
    volumes:
      - ./backend:/code
    working_dir: /code/restaurants
    networks:
      - restaurants




networks:
  activities: {}
  hotels: {}
  maps: {}
  restaurants: {}
  main_app: {}
volumes:
  postgres:
    driver: local
  storage:
    driver: local